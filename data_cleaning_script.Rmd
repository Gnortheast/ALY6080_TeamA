---
title: "Cleaning Script"
author: "Douglas Lunnie"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
#Install/Load Packages
#install.packages("tidyverse")
#install.packages("readxl")
library(tidyverse)
library(tibble)
library(readxl)

```

```{r, include=FALSE}
#Load data into environment. 
#Requires manually renaming raw diary files to the indicated "Raw_diary" listed below. Files must be read from the same directory as this code. 
#Ensure Raw .csv files should be encoded as UTF-8, this can be done via opening the .csv in Notepad>Save As> ... Select UTF-8 encoding and overwrite file.
#Some systems automatically reformat .csv files when opened in Excel. 

#Programming note - Opportunity to have the script reformat the code on read-in. 


demo_names <- read.csv("demo_names.csv")
diary_names <-read.csv("diary_names.csv")


raw_demo <- read_xlsx("Laundry Room Diary Datafile 52 wks ending 10.16.22.xlsx", sheet = "Demos and Segment")


#raw_diary <- read_xlsx("Laundry Room Diary Datafile 52 wks ending 10.16.22.xlsx", sheet = "Diary 10.18.21 to 10.16.22")
# This method crashes down my R session. Will try read csv instead, 

raw_diary <- read.csv("Diary_Whole.csv")
```


```{r, include=FALSE}
#Rename Diary+Demo Files According to new  name set

diary <- raw_diary #simplify name

colnames(diary) <-  colnames(diary_names) #overwrite names to simplify review
colnames(diary)

demo <- raw_demo

colnames(demo) <- colnames(demo_names)
colnames(demo)
```


```{r, include=FALSE}
#remove raw d"f's from environment
rm(raw_demo, raw_diary, demo_names, diary_names)
```



#Intermediate Cleaning Steps


```{r}
#replacee demo respondent age
demo["respondent_age"][demo["respondent_age"] == "Over 80"]  <-  "89"
demo$respondent_age <- as.numeric(demo$respondent_age)

#class(demo$respondent_age) - Check for accuracty and comment out
#hist(demo$respondent_age)
```


```{r, include=FALSE}
demo["child_count"][demo["child_count"] == "None"]  <-  "0"
demo$child_count <- as.numeric(demo$child_count)

class(demo$child_count) #Check for accuracty and comment out
#hist(demo$child_count)
```

```{r}
#Child ages are coded as "NN Years Old"
```


#```{r}
table(demo$child1_age)
#```


#```{r}

for (i in 1:(length(demo$child1_age))){
  if (!is.na(demo$child1_age[i] )) {
  print("Not NA")
}


#```



```{r, include=false}
#write combined files to new CSVs
write.csv(demo, "demographics.csv", row.names = FALSE)
write.csv(diary, "diary.csv", row.names = FALSE)
```



