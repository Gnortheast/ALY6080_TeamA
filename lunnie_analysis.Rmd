---
title: "Lunnie_Analysis"
author: "Douglas Lunnie"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 4
    number_sections: true
    theme: lumen
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
#Remove all items from global environment
rm(list=ls())

#Load required Libraries
#install.packages("tidyverse")
#install.packages("ggpubr")

library(tidyverse)
library(ggpubr)




```

```{r, include = FALSE}
#Load Data

demo_original <- read.csv("demographics.csv")
diary <- read.csv("diary.csv")
demo <- read.csv("demo_unique.csv")
```

# Evaluate VIA's Segmentation Categories

"Segment" data, a recoding of the audience's self-description. 
Is there some relationship with the respondent's attitude toward their laundry and their demographic information? 
```{r}

demo %>% 
  group_by(segment) %>%
  summarize(Count = n()) %>%
  mutate(Percent = 100*(Count/sum(Count)))
  

demo %>% #Possible distnction by age
  ggplot(aes(y = segment, x = respondent_age)) + geom_boxplot()


demo %>% #slight distinction by family size **
  ggplot(aes(y = segment, x = HH_COUNT)) + geom_boxplot()


demo %>% # No distinction by child count
  ggplot(aes(y = segment, x = child_count)) + geom_boxplot()

demo  %>%  #No distinction by Income
  ggplot(aes(y = segment, x = per_cap)) + 
  geom_count()

demo  %>%  #No distinction by Income
  ggplot(aes(y = segment, x = fem_edu_HOH)) + 
  geom_count()

demo  %>%  #No distinction by Income
  ggplot(aes(y = segment, x = male_edu_HOH)) + 
  geom_count()


demo  %>%  #No distinction by Marraige
  ggplot(aes(y = segment, x = marital_code)) + 
  geom_count()

```

## What about Behavior invormation


### Establish Laundry Occurrence Data

It's noted that many respondents did not answer the "Event Count Today" Query accurately. It should have at least as many entries as the "Yes" responses in the "Laundry Event Today" query. 32662 events were counted by this method, while 45043 dairy entries exhibited "Yes" for at least a single laundry event. 



```{r}
table(diary$Event_Count_Today)
events <- sum(diary$Event_Count_Today, na.rm = TRUE) #61921 Laundry Events

table(diary$Laundry_Event_Today.) #48662 Days Laundry performed

```







```{r}



```



###

```{r, include = false}



#combine all events in Event_Count_Today by Res_ID. Differentiates between event today? Yes No and allows for inclusion of multiple events per day. 
eventcount <- diary %>%
  group_by(Res_ID) %>%
   tally(Event_Count_Today)

#Create the laundry events demo table linkage earlier to accomodate the segmentation evaluation

Laundry_Events <- diary %>% 
  group_by(Res_ID) %>% 
  count(Laundry_Event_Today.) %>% 
  pivot_wider(names_from = Laundry_Event_Today., values_from = n)  #Takes output and spreads Y/N to new columns

Laundry_Events[is.na(Laundry_Events)] = 0  #Replace NA values with 0
Laundry_Events <- left_join(Laundry_Events, eventcount, by = 'Res_ID')  
Laundry_Events <- Laundry_Events %>% mutate(Total_Days = No + Yes, Prop_Days = round((Yes / Total_Days), digits = 2 )) #Get summary columns on Laundry events
Laundry_Events <- rename(Laundry_Events, Total_Events = n, Days_Yes = Yes, Days_No = No)
Laundry_Events <- Laundry_Events %>% mutate(Events_Per_Day = Total_Events / Days_Yes)




Events_Demo <- left_join(Laundry_Events, demo, by = c('Res_ID' = 'respondent_id'))  #Link Laundry Events table with Demographic data

```

### Market Segmentation Laundry Use Rate. 

Note scale is n
```{r}
Events_Demo %>% 
     ggplot( aes(x = Prop_Days, y = segment)) + geom_boxplot(position = "dodge", fill = "#1e9fc7") +
  #scale_x_continuous(breaks = seq(25, 90, by = 5)) +
  labs( x= "Proportion of Days", y = "Segment", title = "Segment Day Rate", subtitle = "Do the Segments perform Laundry more or less often?") +
    theme_minimal()
```
```{r}
Events_Demo %>% 
      ggplot( aes(x = Events_Per_Day, y = segment)) + geom_boxplot(position = "dodge", fill = "#1e9fc7") +
  #scale_x_continuous(breaks = seq(25, 90, by = 5)) +
  labs( x= "Events per Day", y = "Segment", title = "Segment Day Volume", subtitle = "Do the Segments perform multiples on lauundry days?") +
    theme_minimal()
```




### REMOVE THIS BLOCK
```{r}
#This is good code but the plot isn't as effective as the boxplots above. Saving for now but will look at more later. 
Events_Demo %>% 
  #filter(segment == "MELLOW METHODICALS") %>%
  ggplot(aes(x = Events_Per_Day)) +
  geom_histogram(aes(y = ..count../sum(..count..)),binwidth = .05, fill = "#1e9fc7") + 
  scale_x_continuous(limits = c(.9, 3)) +
  labs(title = "How Many Loads per Day?", subtitle = "Mean Loads per day for days when laundry is performed", x = "Proportion of Days Laundry is Done", y = "Households Reporting") + 
  facet_wrap(vars(segment), scales = "free")
# This isnt particulary descriptive and I'm having trouble normalizing it. Maybe try a boxplot.

```




```{r}
Events_Demo %>%
 ggplot( aes(x = per_cap)) +
  geom_bar(mapping = aes(x = ..prop.., y = per_cap, group = 1), fill = "#1e9fc7")+
  scale_x_continuous(limits = c(0,.5),  breaks = seq(0, .5, by = .1), minor_breaks = NULL) +
  labs(title = "Segment Income Distributions", y = "Income Category", x = "Proportion") +
facet_wrap(vars(segment), scales = "free")

```

 



## Age Cohorts - Is Age of Respondent representative of the age of the Head of Household? 
```{r}
#Safe to assume that reespondent is usually the HOH?
demo %>% 
  #filter(age_HOH == "Under 25 Years") %>% 
  select("respondent_age", "age_HOH") %>%
  ggplot( aes(x = respondent_age, y = age_HOH)) + geom_boxplot(position = "dodge", fill = "lightblue") +
  scale_x_continuous(breaks = seq(25, 90, by = 5)) +
  labs( x= "Respondent Age", y = "Head of Household Age", title = "Respondent Age IQR Corresponds with HOH Age", subtitle = "Respondent age may be used as a proxy for HOH Age Cohort") +
    theme_minimal()

```

```{r}
#Evaluate Under 40's
```

## Age Cohort - Under 40
```{r}
under40s <- demo %>% 
  filter(respondent_age < 41)

under40s %>% 
  group_by(per_cap) %>% 
  summarize(n = n()) %>%  
  mutate(freq = n / sum(n))
```

### Under 40 - Income Distribution
```{r}
under40s %>% 
  ggplot( aes(x = per_cap)) +
  geom_bar(mapping = aes(x = per_cap, y = ..prop.., group = 1))+
  scale_y_continuous(limits = c(0,.5),  breaks = seq(0, .5, by = .025), minor_breaks = NULL) +
  labs(title = "76% of Under 40's are Middle or Lower Income", y = "Proportion", x = "Income Classification")
```

### Under 40 - Marital Status

```{r}
#Plot the Marriage Proportions
under40s %>% 
  ggplot() +
  geom_bar(mapping = aes(x = marital_code, y = ..prop.., group = 1)) +
  scale_y_continuous(limits = c(0,.8),  breaks = seq(0, .8, by = .05), minor_breaks = NULL) +
  labs(title = "60% of Under 40's are Married, 30% are Single", y = "Proportion", x = "Marital Status")
```

### Under 40 - Own/Rent Frequency

```{r}
#Own or Rent their Home
under40s %>% 
  group_by(own_rent) %>% 
  summarize(n = n()) %>%  
  mutate(freq = n / sum(n))
```

### Under 40s - Onw/Rent Plot

```{r}
#PLot Home Ownership Status
under40s %>% 
  ggplot() +
  geom_bar(mapping = aes(x = own_rent, y = ..prop.., group = 1)) +
  scale_y_continuous(limits = c(0,.5),  breaks = seq(0, .5, by = .05), minor_breaks = NULL) +
  labs(title = "45% of Under 40s own their Home", subtitle = "Who are the 22% NAs?", y = "Proportion", x = "Home Ownership")
```


### Under 40s - Children

```{r}
#Child Status by Marital Status
under40s %>% 
  group_by(marital_code) %>%
  summarize(Mean_Children = mean(child_count), SD_Children = sd(child_count))
```

### Laundry Events Histograms

```{r}
#Who is and isn't doing laundry?

hist(Laundry_Events$prop.Y)


ggplot(Laundry_Events, aes(x = prop.Y)) +
  geom_histogram(binwidth = .05, fill = "#1e9fc7") +
  labs(title = "How Often is Laundry Performed?", subtitle = "Proportion of days in the survey period where respondents performed laundry", x = "Proportion of Days Laundry is Done", y = "Households Reporting")
```



## Are families with kids doing more laundry? 
 
```{r}
events_children <- Events_Demo %>%
  filter(child_count > 0)


events_no_children <- Events_Demo %>%
  filter(child_count == 0)
```


### Households w/ children

```{r}
events_children %>%
  ggplot(aes(x = prop.Y)) +
  geom_histogram(binwidth = .05, fill = "#1e9fc7") +
  labs(title = "Laundry Frequency - Households with Children", subtitle = "Households with Children", x = "Proportion of Days Laundry is Done", y = "Households Reporting") 

```


### No Children

```{r}
events_no_children %>%
  ggplot(aes(x = prop.Y)) +
  geom_histogram(binwidth = .05, fill = "#1e9fc7") +
  labs(title = "Laundry Frequency - Households without Children", subtitle = "Households with Children", x = "Proportion of Days Laundry is Done", y = "Households Reporting")


ggqqplot(events_no_children$prop.Y)

shapiro.test(events_no_children$prop.Y)
```

